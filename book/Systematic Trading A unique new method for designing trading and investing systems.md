# Systematic Trading: A unique new method for designing trading and investing systems



处理不确定性，该在什么位置入场，入场后亏了该怎么办，入场后对了又该怎么办，该在什么位置止损，在什么位置止盈，什么位置加仓

一套完整的处理不确定k线走势的交易逻辑，即交易系统，对混沌的k线走势的观察角度



#### Learning Strategy

1. **Understanding the Basics**
   
   * **Preface** and **Introduction**: Start with these sections to understand the motivation behind systematic trading and the scope of the book.

2. **Theory**
   
   * **Part One**: Focus on understanding why systematic trading is necessary and the psychological biases that affect human traders.

3. **Toolbox**
   
   * **Part Two**: Learn about the tools and techniques used in systematic trading, such as fitting models and portfolio allocation.

4. **Framework**
   
   * **Part Three**: Study the detailed framework for creating systematic strategies, including instrument selection, forecasting, and risk management.

5. **Practice**
   
   * **Part Four**: Apply the learned concepts to real-world scenarios tailored to different types of traders (semi-automatic trader, asset allocating investor, staunch systems trader).

6. **Additional Resources**
   
   * Use the **Glossary** and **Appendices** for definitions and further reading to deepen your understanding of specific concepts and technical details.

By following this structure, you can systematically approach the book and build a strong foundation in designing and implementing trading and investing systems.



#### 三个典型的系统化交易者和投资者群体

**主要观点**：

* **资产配置投资者**：将资金分配到不同的资产类别中，避免短期内追逐时尚，通常不使用杠杆。作者以ETF为例，展示如何应用系统化方法进行资产配置。
* **半自动交易者**：基于市场机会进行交易，使用杠杆和衍生品，通过系统化框架管理头寸和风险。作者以英国股票交易为例，展示半自动交易策略。
* **坚定的系统交易者**：完全依赖系统化交易规则预测价格变化，并使用系统化框架管理头寸和风险。系统交易者通常使用回测软件开发和验证交易规则，作者展示了如何安全地使用这些工具。

**书的结构**：

* **理论部分**：解释为何要运行系统化策略，概述可用的交易风格。
* **工具箱部分**：介绍创建系统化策略的两种关键方法：回测和组合优化。
* **框架部分**：提供一个完整且可扩展的系统化策略创建框架。
* **实践部分**：展示如何将框架应用于三种典型的系统化交易者和投资者。

**人类心理的局限**：

* 尽管人类在复杂智力任务上优于计算机，但情绪会妨碍我们充分利用这些优势。
* 恐惧和贪婪常常导致决策失误，即使是有经验的投资者也难以避免。

**系统化交易的优势**：

* 系统化交易通过消除情绪干扰，使决策更加理性和一致。
* 在极端市场条件下，系统交易能够稳定运行并盈利，而人类容易恐慌。

交易系统应像汽车一样具有模块化设计，可以根据需要进行调整和改进。成功的系统交易不在于神奇的系统，而在于避免常见错误，如系统过于复杂、过于乐观、冒过高风险、交易过于频繁。研究表明，人类为何在做金融决策时容易犯错。简单的交易规则往往比聪明的人类更擅长投资和交易。必须坚持你的系统才能使其有效。

**人类心理缺陷**：

* 尽管人类大脑复杂，但由于认知偏差（cognitive biases），往往表现出非理性的行为。
* 这些本能反应通常会压倒人类在决策上的天然优势，使得简单决策规则更为有效。
  
  

**前景理论（Prospect Theory）**：

* 解释了投资者在面对某些交易决策时为何会犯错，如是否应退出亏损的头寸。
* 大多数人不愿意认赔离场，因为这意味着承认自己犯了错，并且实际化的亏损比账面亏损更让人痛苦。
* 人类本能地不愿意承认亏损是真实的，直到亏损被确认，因此推迟卖出亏损头寸。
* 相反，当头寸获利时，人们会急于获利了结，以避免后悔，并确认自己的买入决策是正确的。

**小额获利和放任亏损的坏处**：

* 提早获利、放任亏损的策略通常效果很差。
* 通过回测发现，与早期亏损止损策略相比，早期获利止损策略在大多数情况下表现较差。
  
  

### Simple Trading Rules

1. **系统化交易规则的优势**：
   
   * 系统化交易规则可以帮助纠正人类本能中的严重缺陷。
   * 同时，这些规则还可以利用其他人类交易者的认知偏差，从市场异常中获利。

2. **认知偏差与交易规则**：
   
   * 例如，早期亏损止损规则不仅仅是纠正人类本能，还能从其他交易者相反的行为中获得额外收益。

3. **确保交易规则的持续有效性**：
   
   * 认知偏差解释了某些交易规则为何能持续获利，使得这些规则在未来仍可能有效。

### Sticking to the Plan

1. **坚持系统的重要性**：
   
   * 若不能坚持执行系统化交易策略，则运行该策略没有意义。
   * 在面对亏损或盈利时，人类本能会干扰系统的执行，导致偏离预定规则。

2. **避免干预**：
   
   * 我们需要一种承诺机制（commitment mechanism）来确保遵守系统规则。
   * 例如，奥德修斯通过让船员无视他的命令来避免被塞壬迷惑。
   * 现代例子如Victor Niederhoffer让助手在达到亏损限额时强制平仓。

3. **客观性系统**：
   
   * 为了确保承诺，交易系统必须是客观的。
   * 许多系统并不完全客观，允许一定程度的主观解释。
   * 纯客观的系统能更好地防止人类干预，并允许进行可靠的回测。
     
     

### Automation – The Use of Dogs in Finance and Engineering

**主要内容**：

1. * 客观系统可以自动化，这是一种良好的承诺机制（commitment mechanism）。
   * 自动化的系统需要明确的规则，例如“20日移动平均线高于40日移动平均线时买入”，而不能依赖主观判断。

2. **自动化的实现**：
   
   * 虽然可以通过纸笔或简单的电子表格手动执行交易，但涉及复杂规则或高频交易时，自动化是必需的。
   * 对于半自动交易者，可以在手动决策后自动化其头寸和风险管理框架。

3. **自动化的干扰问题**：
   
   * 自动化并不能完全阻止人为干预。自动生成交易后仍需人工执行的系统容易被干预。
   * 完全自动化的系统干预难度较大，但仍需要信任和合理设计的系统。

4. **狗和人的比喻**：
   
   * 最好的系统交易设置包括一台计算机、一只狗和一个人。计算机运行全自动策略，人喂狗，如果人干预计算机，狗就咬人。

**避免设计陷阱**：

* **过拟合（Over-fitting）**：
  * 人类大脑倾向于在数据中看到不存在的模式，导致过拟合。
  * 过拟合的系统在真实交易中表现往往不如简单规则。
* **过度交易（Overtrading）**：
  * 过度自信会导致频繁交易，增加交易成本。
  * 频繁交易类似于赌博行为，极少能盈利。
* **过度投注（Over-betting）**：
  * 过度杠杆会增加账户爆仓风险，难以避免人为干预。

**自我实现的预言（Self-Fulfilling Prophecy）**：

* **定义**：某些技术交易系统可能没有理论依据，但因为很多人使用而有效。
* **应用**：如Fibonacci数列在技术分析中的应用。

**交易规则的盈利来源**：

* **风险溢价（Risk Premia）**：通过承担特定风险获得额外回报。
* **偏斜（Skew）**：正偏斜策略（如购买期权）和负偏斜策略（如卖出期权）的不同特征。
* **行为效应**：利用市场参与者的行为弱点获利。

**交易风格分类**：

* **静态 vs 动态**：静态策略较少交易，动态策略频繁交易。
* **技术 vs 基本面**：技术策略使用价格数据，基本面策略使用微观和宏观数据。
* **投资组合规模**：多样化投资组合降低风险，提高回报。
* **杠杆**：合理使用杠杆，避免极端损失。

**交易速度**：

* **非常慢**：类似静态组合，收益较低。
* **中等速度**：回报更具吸引力，适合大多数交易者。
* **快速**：高频交易需考虑交易成本和技术要求。

**现实的夏普比率**：

* 设定合理的期望值，避免因过高期望导致的过度交易和投注。
  
  

### 拟合

本章主要讨论了如何使用数据来选择和校准交易规则，这是系统化交易的关键步骤之一。作者强调了避免过度拟合的重要性，并提供了一些建议，以帮助读者在拟合过程中避免常见的陷阱。

#### 拟合的危险

1. **过度拟合的危险**：过度拟合是指选择和校准过多的交易规则，导致这些规则在历史数据上表现优异，但在未来交易中却不一定有效。过度拟合会导致过于乐观的回测结果。

2. **避免时间机器**：不要使用所有数据进行拟合和测试，这样会导致过度乐观的结果。应使用滚动窗口或扩展窗口的方式进行拟合。

3. **规则选择的风险**：选择单一规则而忽视其他规则可能导致过度自信。通常需要大量历史数据才能区分不同规则的优劣。

4. **数据池化**：为了做出良好的拟合决策，最好将多个工具的数据池化在一起。只有在统计上显著不同的情况下，才应该分别拟合不同的工具。

5. **比较相似的规则**：用夏普比率（SR）比较规则时，需注意正偏和负偏规则之间的差异，因为负偏规则往往会有虚高的SR。

6. **未来与过去不同**：应关注相对于基准的回报，而不是绝对回报，因为过去40年的高回报主要归因于通货膨胀的大幅下降，这种情况不会再重复。

#### 有效拟合的规则

如果你决定进行拟合，请遵循以下建议：

1. **保持简单**：避免使用复杂的拟合法。

2. **减少备选方案**：减少考虑的交易规则和变体的数量，除非有足够多年的数据。

3. **禁止时间机器**：使用滚动或扩展窗口进行拟合，不要使用太短的窗口。

4. **不要轻易丢弃规则**：在选择单一规则或变体并丢弃其他规则之前，仔细考虑它们之间的相关性和表现差异。

5. **数据池化**：合并多个工具的数据，以增加拟合决策的可靠性。

6. **比较相似规则**：使用夏普比率进行规则比较时，要注意正偏和负偏规则之间的差异。

7. **未来与过去不同**：注意相对于基准的回报，不要依赖过去的绝对回报。

#### 作者的规则选择方法

作者倾向于几乎完全避免拟合，而是选择交易规则和变体而不看实际表现：

1. **提出少量交易规则**：根据市场行为提出少量的交易规则。

2. **为每个规则选择几个变体**：此阶段不看表现，而是看交易速度和与其他变体的相关性。

3. **分配预测权重**：根据夏普比率的不确定性分配预测权重。差的规则权重较低，但很少完全排除。

通过这种方法，实际历史表现数据保留用于确定预测权重，从而避免过度拟合。

**时间机器的陷阱**：

* **In-Sample测试**：使用整个数据集进行拟合和测试，会导致过于乐观的结果。
* **Out-of-Sample测试**：分割数据集，将前一半用于拟合，后一半用于测试，但这种方法浪费了数据。
* **Expanding Window**：使用扩展窗口方法，每次增加一个新的数据点进行拟合和测试。
* **Rolling Window**：使用滚动窗口方法，定期丢弃旧数据，只使用最新的数据进行拟合和测试。

#### 关键总结

* 避免过度拟合，使用充足的历史数据。
* 保持规则和变体的数量较少，避免复杂性。
* 通过数据池化增加拟合决策的可靠性。
* 不要仅依据历史表现选择规则，而是结合交易成本和相关性等因素进行决策。

本章为系统化交易提供了有效拟合的方法和原则，强调了简化和数据池化的重要性，以确保交易规则在实际应用中的有效性。



### 投资组合分配

本章讨论了如何在不同的工具或交易规则之间分配交易资金。这对于系统化投资者和交易者来说非常重要，特别是那些运行多种交易规则的系统交易者。

#### 投资组合分配的优化

投资组合优化旨在找到资产权重的最佳组合，以实现预期的风险调整回报，通常以夏普比率（Sharpe Ratio）来衡量。这种方法最早由哈里·马科维茨在20世纪50年代提出，尽管数学优美，但盲目使用会导致极端的投资组合权重。

#### 优化的局限

经典的优化方法会产生极端的投资组合权重，这在实际操作中可能会失败。这种极端组合通常将大部分资金分配到少数资产上，而忽视了其他资产的潜在价值。

#### 如何修正优化问题

有两种方法可以改善优化过程：

1. **引导法（Bootstrapping）**：通过重复优化，平均多次优化结果，避免极端权重。
2. **手工权重分配法（Handcrafting）**：手工构建权重，结合历史数据和经验估计，确保投资组合的稳定性和合理性。

### 手工权重分配法

手工权重分配法通过自下而上地构建投资组合，首先在小组内分配权重，然后在组间分配。这种方法依赖于资产的相关性和预期的夏普比率。

#### 手工分配步骤

1. **确定资产组**：根据资产的相关性将其分组。组内资产相关性高，组间相关性低。
2. **分配组内权重**：根据表格（见表8），分配组内权重。
3. **分配组间权重**：根据组间相关性，分配组间权重。
4. **计算总权重**：每个资产的总权重是组内权重乘以组间权重。

#### 实例分析

通过实例分析，例如三资产组合（美国国债、标普500指数、纳斯达克指数），使用手工分配法可以得到更稳定的权重分配，避免极端值。

#### 更复杂的实例

对于更复杂的组合，例如包含多个国家和行业的股票和债券组合，可以使用分层分组的方法，自下而上地构建权重。这种方法在实践中更为灵活和稳健。

#### 优化的挑战

1. **优化的局限性**：
   
   * 经典的马科维茨优化方法会产生极端的投资组合权重，这在实际操作中可能导致失败。
   * 极端组合通常将大部分资金分配到少数资产上，忽视了其他资产的潜在价值。

2. **不稳定的权重**：
   
   * 例如，将资金分配在纳斯达克、标普500指数和美国20年期国债上，使用单期优化方法会导致权重极不稳定，甚至可能完全排除某些资产。

#### 修正优化问题的方法

1. **引导法（Bootstrapping）**：
   
   * 通过重复优化，平均多次优化结果，避免极端权重。
   * 优点在于即使数据噪声较大，平均结果仍能反映实际情况。

2. **手工权重分配法（Handcrafting）**：
   
   * 手工构建权重，结合历史数据和经验估计，确保投资组合的稳定性和合理性。
   * 步骤包括确定资产组、分配组内权重、分配组间权重，并计算总权重。

### 总结

本章提出了避免过度拟合和优化的有效方法，通过手工权重分配法和引导法，确保投资组合的多样性和稳定性，避免了经典优化方法可能带来的极端权重问题。这些方法不仅适用于交易规则的分配，也适用于实际资产的分配，为系统化交易者提供了实用的工具和策略。





#### 框架的组成部分

根据表15的例子，一个小型交易系统包含两种交易规则（A和B），每种规则有多个变体（A1、A2、B1），以及两个交易工具（X和Y）。整个系统可以分为以下几个组件：

1. **交易规则和变体**：
   
   * 每个交易规则及其变体会生成一个特定工具的价格预测。例如，A1对工具X的预测，A2对工具X的预测，B1对工具X的预测，等等。

2. **预测**：
   
   * 每个交易规则生成的预测表示该工具预期的价格变动。

3. **综合预测**：
   
   * 将多个预测合并为每个工具的单一预测。这可以通过加权平均法进行。

4. **波动率目标**：
   
   * 确定你愿意接受的风险水平（例如，平均每日损失）。这个步骤确保风险得到控制并与整体交易策略保持一致。

5. **头寸大小**：
   
   * 基于综合预测和波动率目标，计算每个工具的头寸大小。

6. **子系统头寸**：
   
   * 对于每个工具，确定其在各自交易子系统内的头寸大小。

7. **工具权重**：
   
   * 根据权重方案分配资本给每个交易子系统（每个工具）。

8. **组合加权头寸**：
   
   * 将每个工具的子系统头寸合并为整体组合头寸。



| 项目   | 规则                                              |
| ---- | ----------------------------------------------- |
| 入场规则 | 当20日移动平均线上穿40日移动平均线时买入，反之亦然。                    |
| 出场规则 | 当入场规则被打破时反向操作：如果持有多头，当20日移动平均线下穿40日移动平均线时卖出并做空。 |
| 仓位大小 | 每次交易不超过10手欧元美元期货合约，1手富时100指数合约或每点£10的差价合约。      |
| 资金管理 | 每次交易风险不超过总资本的3%。                                |
| 止损规则 | 设置跟踪止损，当损失达到总资本的3%时平仓。如果止损触发频率过高，则扩大止损范围。       |

### 预测

#### 交易系统的基础：预测

在这章中，我们将详细探讨如何生成和使用预测来驱动交易系统。无论你是坚定的系统交易者、半自动交易者还是资产配置投资者，理解和利用预测对于成功的交易策略至关重要。

#### 1. 什么是一个好的预测

**预测是一个数值**

预测表示对某一资产价格变动的估计。正值预测意味着你预计价格会上涨，负值预测则表示你预计价格会下跌。预测不应该是二元的（买或卖），而应该是标量的。靠近零的预测表示价格变动较小，而绝对值较大的预测则表示你预计价格变动较大。

**预测应与风险调整回报成比例**

好的预测应与风险调整后的预期回报成比例。例如，如果德债（Bund）的预期年回报为2%，年化标准差为8%，而德国短期国债（Schatz）的预期年回报为1%，但年化标准差仅为2%，那么风险调整后Schatz的预期回报（1% ÷ 2% = 0.5）应比Bund的预期回报（2% ÷ 8% = 0.25）高出两倍。因此，Schatz的预测应是Bund的两倍。

**预测应具有一致的尺度**

预测的预期绝对值应为10。这样，+10表示一般的买入，-10表示一般的卖出。预测值接近零表示较小的变动，而+20或-20则表示很强的预测。对于半自动交易者，需要量化你的信心强度；资产配置投资者则使用固定的预测值。

**预测值的上限**

预测值应限制在一个最大绝对值内，我建议限制在20以内。原因包括：

- **风险控制**：限制单个交易规则的风险。
- **数据有限**：大预测值在历史数据中很少见，因此可靠性较低。
- **极端情况不同**：市场在极端情况下的行为可能与平时不同。
- **更高的实际波动性**：高预测值可能意味着预期回报大，但也可能伴随更高的波动性。
- **有限的下行风险**：由于大多数预测值较小，限制预测值对总回报的影响较小。

系统交易者应将所有超出范围的预测值调整到-20至+20之间。对于半自动交易者，所有的预测值都应在-20至+20之间。资产配置投资者则使用固定的+10预测值。

#### 2. 交易规则的示例

以下是两个简单的系统交易规则示例：

1. **趋势跟踪规则**
   
   - 使用一组移动平均线交叉来识别趋势。
   - 例如，当短期均线超过长期均线时，生成正向预测。

2. **价值投资规则**
   
   - 基于估值指标如市盈率（P/E）来生成预测。
   - 例如，当某一股票的P/E比率低于历史平均水平时，生成正向预测。

#### 3. 其他人的交易规则

你可以使用公共可用的交易规则，或自己发明交易规则。重要的是要对这些规则进行标准化处理，使其生成的预测具有一致的尺度。

#### 4. 选择交易规则和变体

回顾前面章节提到的选择规则和变体的过程，确保你选择的交易规则能够适应不同的市场和时间框架。

### 总结

生成和使用预测是构建交易系统的核心。无论是系统交易者、半自动交易者还是资产配置投资者，理解预测的生成和应用至关重要。通过标准化和调整预测值，确保交易系统能够在不同的市场条件下有效运作。


